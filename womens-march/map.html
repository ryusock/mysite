<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link type="text/css" rel="stylesheet" href="../css/bootstrap.css"/>
  <link type="text/css" rel="stylesheet" href="../css/stylesheet.css"/>
  <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYrVGbeK2Bz8I3mZHlyIGkIqKEZ9fweQI&callback=initMap"
  type="text/javascript"></script>
  <script type='text/javascript'>
   	google.charts.load('upcoming', {'packages': ['geochart']});
   	google.charts.setOnLoadCallback(drawMarkersMapLow);
   	google.charts.setOnLoadCallback(drawMarkersMapHigh);
   	var isLow = true;
   	var geocode = null;

   	function httpGetAsync(theUrl, callback) {
    	var xmlHttp = new XMLHttpRequest();
    	xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
        	callback(xmlHttp.responseText);
    	}
    	xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    	xmlHttp.send(null);
		}
		httpGetAsync("http://ryusock.github.io/womens-march/crowd-estimates.txt", readText)

		var rows = []
		var lowArray = [["Latitude", "Longitude", "City", "Crowd Estimate (Low)"]];
		var highArray = [["Latitude", "Longitude", "City", 'Crowd Estimate (High)']];
		function readText(text) {
			rows = text.split("\n");
			for (i = 0; i < rows.length; i++) {
				var r = rows[i].split(";");
				var location = r[0].replace(/'/g, "");
				var lat = parseFloat(r[1]);
				var lng = parseFloat(r[2]);
				var lowcount = parseInt(r[5]);
				var highcount = parseInt(r[6]);
				if (location.length !== 0) {
					lowArray.push([lat, lng, location, lowcount]);
					highArray.push([lat, lng, location, highcount]);
				}
			}

		}
   	
    function drawMarkersMapLow() {
    	var data = google.visualization.arrayToDataTable(lowArray);

    	var options = {
      	region: 'US',
      	displayMode: 'markers',
      	colorAxis: {colors: ['green', 'blue']}
   		};

    	var chart = new google.visualization.GeoChart(document.getElementById('lowDiv'));
    	chart.draw(data, options);
  	};

  	function drawMarkersMapHigh() {
    	var data = google.visualization.arrayToDataTable(highArray);

    	var options = {
      	region: 'US',
      	displayMode: 'markers',
      	colorAxis: {colors: ['green', 'blue']}
   		};

    	var chart = new google.visualization.GeoChart(document.getElementById('highDiv'));
    	chart.draw(data, options);
    	document.getElementById('highDiv').style.display = 'none';
  	};

  	function toggleGraph() {
  		if (isLow) {
  			document.getElementById('lowDiv').style.display = 'none';
  			document.getElementById('highDiv').style.display = 'block'
  			isLow = false;
  		} else {
  			document.getElementById('lowDiv').style.display = 'block';
  			document.getElementById('highDiv').style.display = 'none';
  			isLow = true;
  		}
  	}
  </script>
  <title>Women's March</title>
</head>

<body>
<div class="container">
	<h1>Visualizing the Women's March crowd estimates at US cities</h1>
	<h4>Local organizers and observers estimated the count of protesters who attended their cities' Women's Marches. This data was compiled on a spreadsheet which you can find <a href="https://docs.google.com/spreadsheets/d/1xa0iLqYKz8x9Yc_rfhtmSOJQ2EGgeUVjvV4A8LsIaxY/edit#gid=0">here</a>. The graphic below shows the low and high estimates for crowd sizes at all 622 towns and cities that held a Women's March.</h4>
</div>
<div class="container">
	<div id="lowDiv" style=""></div>
	<div id="highDiv" style=""></div>
	<button onclick="toggleGraph()">Toggle Low/High Estimate</button>
</div>
</body>
</html>
